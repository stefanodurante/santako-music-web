---
import { content } from "../../data/mock/content";

const today = new Date().toISOString().split("T")[0];

/**
 * EVENTOS FUTUROS
 */
const futureEvents = content
  .filter(
    (item): item is Extract<typeof item, { type: "EVENTO" }> =>
      item.type === "EVENTO" &&
      !!item.data.date &&
      item.data.date >= today
  )
  .sort((a, b) => (a.data.date! > b.data.date! ? 1 : -1));

/**
 * EVENTOS PASADOS (fallback)
 */
const pastEvents = content
  .filter(
    (item): item is Extract<typeof item, { type: "EVENTO" }> =>
      item.type === "EVENTO" &&
      !!item.data.date &&
      item.data.date < today
  )
  .sort((a, b) => (a.data.date! < b.data.date! ? 1 : -1));

const featured =
  futureEvents[0] || pastEvents[0];

const isFuture =
  featured && featured.data.date && featured.data.date >= today;
---

{featured && (
  <section id="agenda-home" class="section-agenda px-6 md:px-12 xl:px-24 py-24" style="background-color: var(--color-bg-agenda);">

    <div class="max-w-6xl mx-auto">

      <!-- EYEBROW -->
      <span class="text-xs uppercase tracking-widest opacity-60">
        Agenda
      </span>

      <!-- TITULAR -->
      <h2 class="font-heading text-4xl md:text-5xl mt-4 mb-6">
        {isFuture ? "Próxima actividad" : "Actividad reciente"}
      </h2>

      <!-- BLOQUE -->
      <div class="border border-black/10 p-8 bg-white">

        <span class="text-xs uppercase tracking-widest opacity-60">
          {featured.data.label}
        </span>

        <h3 class="font-heading text-3xl mt-2 mb-2">
          {featured.data.title}
        </h3>

        <p class="opacity-70 mb-6">
          {new Date(featured.data.date!).toLocaleDateString("es-ES", {
            day: "numeric",
            month: "long",
            year: "numeric",
          })}
        </p>

        <div class="flex flex-wrap gap-6 items-center">

          <!-- CTA PRINCIPAL -->
          <a
            href={`/evento/${featured.data.slug}`}
            class="text-sm uppercase tracking-widest border-b border-black pb-1 hover:opacity-70 transition"
          >
            {isFuture ? "Ver evento" : "Ver actividad"}
          </a>

          <!-- CTA SECUNDARIO -->
          <a
            href="/agenda"
            class="text-sm uppercase tracking-widest opacity-60 hover:opacity-100 transition"
          >
            Ver agenda completa →
          </a>

        </div>

      </div>

    </div>

  </section>
)}
