---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getPosts, decodeHtmlEntities, stripHtml } from "../../lib/wordpress";

/**
 * CARGA POSTS DESDE WORDPRESS
 */
const posts = await getPosts({ perPage: 12 });
---

<BaseLayout title="Noticias · Santako Music">
  <section id="noticias" class="section-noticias px-6 md:px-12 xl:px-24 py-24">
    <header class="mb-12">
      <h1 class="font-heading text-4xl md:text-5xl mb-4">Noticias</h1>
      <p class="text-lg opacity-70 max-w-2xl">
        Últimas noticias y novedades de Santako Music
      </p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {posts.map((post) => (
        <article class="group">
          {post.featured_image_src && (
            <div class="aspect-video overflow-hidden rounded-lg mb-4">
              <img
                src={post.featured_image_src}
                alt={decodeHtmlEntities(post.title.rendered)}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
              />
            </div>
          )}

          <time class="text-xs uppercase tracking-widest opacity-50">
            {new Date(post.date).toLocaleDateString("es-ES", {
              day: "numeric",
              month: "long",
              year: "numeric",
            })}
          </time>

          <h2 class="font-heading text-2xl mt-2 mb-3">
            <a 
              href={`/noticias/${post.slug}`}
              class="hover:opacity-70 transition"
              set:html={post.title.rendered}
            />
          </h2>

          <p class="opacity-70 line-clamp-3">
            {stripHtml(post.excerpt.rendered)}
          </p>

          <a
            href={`/noticias/${post.slug}`}
            class="inline-block mt-4 text-sm uppercase tracking-widest border-b pb-1 hover:opacity-70 transition"
            style="border-color: var(--color-text);"
          >
            Leer más
          </a>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
