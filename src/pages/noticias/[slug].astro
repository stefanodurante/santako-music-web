---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getPosts, getPostBySlug, decodeHtmlEntities } from "../../lib/wordpress";

/**
 * GENERA RUTAS ESTÁTICAS PARA CADA POST
 */
export async function getStaticPaths() {
  const posts = await getPosts({ perPage: 100 });
  
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

/**
 * OBTIENE EL POST ACTUAL
 */
const { slug } = Astro.params;
const post = await getPostBySlug(slug as string);

if (!post) {
  return Astro.redirect("/404");
}

const title = decodeHtmlEntities(post.title.rendered);
---

<BaseLayout title={`${title} · Santako Music`}>
  <article id="noticia" class="section-noticia px-6 md:px-12 xl:px-24 py-24 max-w-4xl">
    <header class="mb-12">
      <time class="text-xs uppercase tracking-widest opacity-50">
        {new Date(post.date).toLocaleDateString("es-ES", {
          day: "numeric",
          month: "long",
          year: "numeric",
        })}
      </time>

      <h1 class="font-heading text-4xl md:text-5xl mt-4" set:html={post.title.rendered} />
    </header>

    {post.featured_image_src && (
      <div class="aspect-video overflow-hidden rounded-lg mb-12">
        <img
          src={post.featured_image_src}
          alt={title}
          class="w-full h-full object-cover"
        />
      </div>
    )}

    <div 
      class="prose prose-lg max-w-none"
      style="color: var(--color-text);"
      set:html={post.content.rendered}
    />

    <footer class="mt-16 pt-8 border-t border-black/10">
      <a
        href="/noticias"
        class="text-sm uppercase tracking-widest border-b pb-1 hover:opacity-70 transition"
        style="border-color: var(--color-text);"
      >
        ← Volver a noticias
      </a>
    </footer>
  </article>
</BaseLayout>
