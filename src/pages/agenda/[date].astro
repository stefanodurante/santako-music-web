---
import BaseLayout from "../../layouts/BaseLayout.astro";
import MainNav from "../../components/nav/MainNav.astro";
import ContactBlock from "../../components/home/ContactBlock.astro";
import { content } from "../../data/mock/content";

/**
 * GENERAMOS UNA PÁGINA POR CADA DÍA CON EVENTOS
 */
export function getStaticPaths() {
  const events = content.filter(
    (item) => item.type === "EVENTO" && item.data.date,
  );

  // Sacamos fechas únicas
  const uniqueDates = Array.from(
    new Set(events.map((event) => event.data.date)),
  );

  return uniqueDates.map((date) => ({
    params: { date },
  }));
}

/**
 * FECHA ACTUAL DESDE LA URL
 */
const { date } = Astro.params;

/**
 * EVENTOS DE ESTE DÍA
 */
const eventsOfDay = content.filter(
  (item) => item.type === "EVENTO" && item.data.date === date,
);
---

<BaseLayout title={`Agenda · ${date}`}>
  <!-- NAV -->
  <MainNav />

  <!-- HERO DEL DÍA -->
  <section class="px-6 md:px-12 xl:px-24 py-16 container-wide">
    <span class="block text-xs uppercase tracking-widest opacity-60 mb-2">
      Agenda · Día
    </span>

    <h1 class="font-heading text-5xl md:text-6xl">
      {date}
    </h1>

    <p class="mt-4 max-w-md opacity-80">
      Programación cultural de Santako Music para este día.
    </p>
  </section>

  <!-- LISTADO DE EVENTOS DEL DÍA -->
  <section class="px-6 md:px-12 xl:px-24 py-24 container-wide">
    <ul class="space-y-16 max-w-3xl">
      {
        eventsOfDay.map((event) => (
          <li class="border-b pb-10">
            <span class="block text-xs uppercase tracking-widest text-[--color-accent-event] mb-2">
              {event.data.label || "Evento"}
            </span>

            <h2 class="font-heading text-3xl mb-4">
              <a href={`/evento/${event.data.slug}`} class="underline">
                {event.data.title}
              </a>
            </h2>

            {event.data.images?.[0] && (
              <img
                src={event.data.images[0]}
                alt={event.data.title}
                class="mt-6 w-full max-w-md"
              />
            )}

            <p class="mt-4 opacity-70">
              Evento organizado por Santako Music dentro de su programación
              cultural.
            </p>
          </li>
        ))
      }

      {
        eventsOfDay.length === 0 && (
          <li class="opacity-60">No hay eventos programados para este día.</li>
        )
      }
    </ul>
  </section>

  <!-- CTA FINAL -->
  <ContactBlock />
</BaseLayout>
