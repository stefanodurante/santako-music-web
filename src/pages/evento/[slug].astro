---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Tag from "../../components/ui/Tag.astro";
import { content } from "../../data/mock/content";

export function getStaticPaths() {
  return content
    .filter((item) => item.type === "EVENTO")
    .map((item) => ({
      params: { slug: item.data.slug },
    }));
}

const { slug } = Astro.params;

const event = content.find(
  (item) => item.type === "EVENTO" && item.data.slug === slug,
);

if (!event) throw new Error("Evento no encontrado");

const related = content.filter((item) =>
  event.data.related.includes(item.data.slug),
);
---

<BaseLayout title={event.data.title}>
  <!-- HERO -->
  <header id="evento-hero" class="section-hero relative h-[60vh] min-h-[420px]">
    <img
      src={event.data.images?.[0] || "/images/placeholder.svg"}
      alt={event.data.title}
      class="absolute inset-0 w-full h-full object-cover"
      loading="eager"
    />
    <div class="absolute inset-0 bg-black/50"></div>

    <div class="relative h-full flex items-end p-10 text-white max-w-6xl">
      <div>
        <Tag label="Evento" variant="event" />
        <h1 class="font-heading text-5xl mt-4">
          {event.data.title}
        </h1>
        {event.data.date && <p class="opacity-80 mt-2">{event.data.date}</p>}
      </div>
    </div>
  </header>

  <!-- CONTENIDO -->
  <main id="evento-content" class="section-content p-10 max-w-3xl">
    <section class="section-related">
      <h2 class="font-heading text-2xl mb-4">Artistas participantes</h2>

      <ul class="space-y-3">
        {
          related.map((item) => (
            <li>
              <a href={`/persona/${item.data.slug}`} class="underline">
                {item.data.title}
              </a>
            </li>
          ))
        }
      </ul>
    </section>
  </main>
</BaseLayout>
